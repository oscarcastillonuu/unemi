{% extends "basebs.html" %}
{% load sga_extras %}
{% load humanize %}
{% block heading %}
    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="/static/js/bootstrap-filestyle.min.js?v=1.0.1"> </script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine.js?v=1.0.0'></script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine-es.js?v=1.0.0' ></script>
    <link type='text/css' rel='stylesheet' href="/static/css/validationEngine.jquery.css?v=1.0.0"/>
    <script type="text/javascript">
        $(function() {
            $("#id_fecha_de").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            $("#id_fecha_hasta").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });
            $("#id_fechadesembolso").datepicker({format:"dd-mm-yyyy"}).on('changeDate', function(ev){ $(this).datepicker('hide'); });

            $("#id_fecha_de, #id_fecha_hasta,#id_fechadesembolso").blur(function () {
                fechavalida($(this));
            });

            $("#id_archivodesembolso, #id_observaciondes, #id_estadodes").addClass("validate[required]");

            $("#id_estadodes").change(function () {
                var estado = $("#id_estadodes").val();
                $("#id_observaciondes").val('');
                $("#id_archivodesembolso").val('').trigger("change");
                $("#id_fechadesembolso").val('').trigger("blur");
                if(estado == 11){
                    $('#id_archivodesembolso').prop('disabled', true);
                    $('#id_fechadesembolso').prop('disabled', true);
                }
                else{
                    $('#id_archivodesembolso').prop('disabled', false);
                    $('#id_fechadesembolso').prop('disabled', false);
                }
            });


            busqueda = function(){
                var term = $("#searchinput").val().trim().toUpperCase();
                if (term.length>0){
                    var estado = $("#selEstadoSol").val();
                    location.href = "/adm_aprobarcapdocente?fase={{ fase }}&s="+term+"&eSol="+estado+"{% if action %}&action=participantes{% endif %}";
                }
                return false;
            };


            $("#search").click(function() {
                busqueda();
            });

            $('#searchinput').keyup(function(e) {
                if(e.keyCode == 13) {
                    busqueda();
                }
            });
            clienteinfo = function(window) {
                {
                    var unknown = '-';

                    // screen
                    var screenSize = '';
                    if (screen.width) {
                        width = (screen.width) ? screen.width : '';
                        height = (screen.height) ? screen.height : '';
                        screenSize += '' + width + " x " + height;
                    }

                    // browser
                    var nVer = navigator.appVersion;
                    var nAgt = navigator.userAgent;
                    var browser = navigator.appName;
                    var version = '' + parseFloat(navigator.appVersion);
                    var majorVersion = parseInt(navigator.appVersion, 10);
                    var nameOffset, verOffset, ix;

                    // Opera
                    if ((verOffset = nAgt.indexOf('Opera')) != -1) {
                        browser = 'Opera';
                        version = nAgt.substring(verOffset + 6);
                        if ((verOffset = nAgt.indexOf('Version')) != -1) {
                            version = nAgt.substring(verOffset + 8);
                        }
                    }
                    // Opera Next
                    if ((verOffset = nAgt.indexOf('OPR')) != -1) {
                        browser = 'Opera';
                        version = nAgt.substring(verOffset + 4);
                    }
                    // MSIE
                    else if ((verOffset = nAgt.indexOf('MSIE')) != -1) {
                        browser = 'Microsoft Internet Explorer';
                        version = nAgt.substring(verOffset + 5);
                    }
                    // Chrome
                    else if ((verOffset = nAgt.indexOf('Chrome')) != -1) {
                        browser = 'Chrome';
                        version = nAgt.substring(verOffset + 7);
                    }
                    // Safari
                    else if ((verOffset = nAgt.indexOf('Safari')) != -1) {
                        browser = 'Safari';
                        version = nAgt.substring(verOffset + 7);
                        if ((verOffset = nAgt.indexOf('Version')) != -1) {
                            version = nAgt.substring(verOffset + 8);
                        }
                    }
                    // Firefox
                    else if ((verOffset = nAgt.indexOf('Firefox')) != -1) {
                        browser = 'Firefox';
                        version = nAgt.substring(verOffset + 8);
                    }
                    // MSIE 11+
                    else if (nAgt.indexOf('Trident/') != -1) {
                        browser = 'Microsoft Internet Explorer';
                        version = nAgt.substring(nAgt.indexOf('rv:') + 3);
                    }
                    // Other browsers
                    else if ((nameOffset = nAgt.lastIndexOf(' ') + 1) < (verOffset = nAgt.lastIndexOf('/'))) {
                        browser = nAgt.substring(nameOffset, verOffset);
                        version = nAgt.substring(verOffset + 1);
                        if (browser.toLowerCase() == browser.toUpperCase()) {
                            browser = navigator.appName;
                        }
                    }
                    // trim the version string
                    if ((ix = version.indexOf(';')) != -1) version = version.substring(0, ix);
                    if ((ix = version.indexOf(' ')) != -1) version = version.substring(0, ix);
                    if ((ix = version.indexOf(')')) != -1) version = version.substring(0, ix);

                    majorVersion = parseInt('' + version, 10);
                    if (isNaN(majorVersion)) {
                        version = '' + parseFloat(navigator.appVersion);
                        majorVersion = parseInt(navigator.appVersion, 10);
                    }

                    // mobile version
                    var mobile = /Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(nVer);

                    // cookie
                    var cookieEnabled = (navigator.cookieEnabled) ? true : false;

                    if (typeof navigator.cookieEnabled == 'undefined' && !cookieEnabled) {
                        document.cookie = 'testcookie';
                        cookieEnabled = (document.cookie.indexOf('testcookie') != -1) ? true : false;
                    }

                    // system
                    var os = unknown;
                    var clientStrings = [
                        {s:'Windows 10', r:/(Windows 10.0|Windows NT 10.0)/},
                        {s:'Windows 8.1', r:/(Windows 8.1|Windows NT 6.3)/},
                        {s:'Windows 8', r:/(Windows 8|Windows NT 6.2)/},
                        {s:'Windows 7', r:/(Windows 7|Windows NT 6.1)/},
                        {s:'Windows Vista', r:/Windows NT 6.0/},
                        {s:'Windows Server 2003', r:/Windows NT 5.2/},
                        {s:'Windows XP', r:/(Windows NT 5.1|Windows XP)/},
                        {s:'Windows 2000', r:/(Windows NT 5.0|Windows 2000)/},
                        {s:'Windows ME', r:/(Win 9x 4.90|Windows ME)/},
                        {s:'Windows 98', r:/(Windows 98|Win98)/},
                        {s:'Windows 95', r:/(Windows 95|Win95|Windows_95)/},
                        {s:'Windows NT 4.0', r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},
                        {s:'Windows CE', r:/Windows CE/},
                        {s:'Windows 3.11', r:/Win16/},
                        {s:'Android', r:/Android/},
                        {s:'Open BSD', r:/OpenBSD/},
                        {s:'Sun OS', r:/SunOS/},
                        {s:'Linux', r:/(Linux|X11)/},
                        {s:'iOS', r:/(iPhone|iPad|iPod)/},
                        {s:'Mac OS X', r:/Mac OS X/},
                        {s:'Mac OS', r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},
                        {s:'QNX', r:/QNX/},
                        {s:'UNIX', r:/UNIX/},
                        {s:'BeOS', r:/BeOS/},
                        {s:'OS/2', r:/OS\/2/},
                        {s:'Search Bot', r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}
                    ];
                    for (var id in clientStrings) {
                        var cs = clientStrings[id];
                        if (cs.r.test(nAgt)) {
                            os = cs.s;
                            break;
                        }
                    }

                    var osVersion = unknown;

                    if (/Windows/.test(os)) {
                        osVersion = /Windows (.*)/.exec(os)[1];
                        os = 'Windows';
                    }

                    switch (os) {
                        case 'Mac OS X':
                            osVersion = /Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1];
                            break;

                        case 'Android':
                            osVersion = /Android ([\.\_\d]+)/.exec(nAgt)[1];
                            break;

                        case 'iOS':
                            osVersion = /OS (\d+)_(\d+)_?(\d+)?/.exec(nVer);
                            osVersion = osVersion[1] + '.' + osVersion[2] + '.' + (osVersion[3] | 0);
                            break;
                    }

                    // flash (you'll need to include swfobject)
                    /* script src="//ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js" */
                    var flashVersion = 'no check';
                    if (typeof swfobject != 'undefined') {
                        var fv = swfobject.getFlashPlayerVersion();
                        if (fv.major > 0) {
                            flashVersion = fv.major + '.' + fv.minor + ' r' + fv.release;
                        }
                        else  {
                            flashVersion = unknown;
                        }
                    }
                }

                window.jscd = {
                    screen: screenSize,
                    browser: browser,
                    browserVersion: version,
                    browserMajorVersion: majorVersion,
                    mobile: mobile,
                    os: os,
                    osVersion: osVersion,
                    cookies: cookieEnabled,
                    flashVersion: flashVersion
                };
            };

            clienteinfo(window);

            var navegador = jscd.browser +' '+ jscd.browserMajorVersion;
            var os =  jscd.os +' '+ jscd.osVersion;
            var cookies = jscd.cookies;
            var screensize = jscd.screen;

            $(".tl").tooltip({position:"center up"});
            $(".informacioncap").click(function(){
                var id = $(this).attr('idt');
                var soli_director = $(this).attr('soli_director');
                var soli_decano = $(this).attr('soli_decano');
                var soli_vicerrec = $(this).attr('soli_vicerrec');
                var estadoSol=$("#estado_solicitud_"+id).attr('cest');
                {#var faseActual="{{ fase }}";#}
                var faseActual=$("#seltipoautoridad").val();
                if(estadoSol!=6){
                    {#alert(estadoSol)#}
                    {#alert(faseActual)#}
                    if((faseActual=='VAL' && (estadoSol==1 || estadoSol==2)) || (soli_director.toLowerCase() === "true") || (soli_decano.toLowerCase() === "true") || (soli_vicerrec.toLowerCase() === "true") ){
                        $("#detallecap_guardar").show();
                    }
                    else
                    if(faseActual=='APR' && (estadoSol==2 || estadoSol==3)){
                        $("#detallecap_guardar").show();
                    }
                    else
                    if(faseActual=='AUT' && (estadoSol==3 || estadoSol==4)){
                        $("#detallecap_guardar").show();
                    }
                    else
                    if(faseActual=='DES' && (estadoSol==5 || estadoSol==6)){
                        $("#detallecap_guardar").show();
                    }
                    else{
                        $("#detallecap_guardar").hide();
                    }
                }
                else {
                    $("#detallecap_guardar").hide();
                }

                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/adm_aprobarcapdocente",
                    {#data: {'action':'detallecap', 'id': id, 'fase': '{{ fase }}' },#}
                    data: {'action':'detallecap', 'id': id, 'fase': faseActual },
                    success: function(data) {
                        $.unblockUI();
                        if (data.result=='ok'){
                            $("#detallecap_body").html(data.html);
                            $("#detallecap").modal({"backdrop":"static", "width": "1000px"}).modal("show");

                            if(faseActual=='VAL')
                                smoke.alert($("#mensajeValidaSolicitud").html());
                            else
                            if(faseActual=='APR')
                                smoke.alert($("#mensajeApruebaSolicitud").html());
                            else
                            if(faseActual=='AUT')
                                smoke.alert($("#mensajeAutorizaSolicitud").html());

                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
                return false;
            });

            $("#detallecap_guardar").click(function(){
                var id = $("#id_capacitacion").val();
                var obse = $("#id_observacion").val();
                var esta = $("#id_estadosolicitud").val();
                var criterios = ""


                if(obse.length<1){
                    smoke.alert("Ingrese una observación.");
                    $("#id_observacion").focus();
                    return false;
                }
                if(esta == "0"){
                    smoke.alert("Selecione el estado de la solicitud");
                    $("#id_estadosolicitud").focus();
                    return false;
                }

                $(".criterio").each(function(){
                    if(criterios.length==0)
                        criterios = $(this).attr("idp")+","+ $(this).is(":checked");
                    else
                        criterios = criterios+"|"+ $(this).attr("idp")+","+ $(this).is(":checked");
                });
                var faseActual=$("#seltipoautoridad").val();

                bloqueointerface();

                $.ajax({
                    type: "POST",
                    url: "/adm_aprobarcapdocente",
                    {#data: {'id': id, 'obse': obse, 'esta': esta, 'criterios': criterios, 'action': 'addcaprecorrido','fase': '{{ fase }}', 'navegador': navegador, 'os': os, 'cookies': cookies, 'screensize': screensize},#}
                    data: {'id': id, 'obse': obse, 'esta': esta, 'criterios': criterios, 'action': 'addcaprecorrido','fase': faseActual, 'navegador': navegador, 'os': os, 'cookies': cookies, 'screensize': screensize},
                    success: function(data) {
                        if (data.result=='ok') {
                            $("#itemspanel").modal("hide");

                            location.reload();

                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        smoke.alert("Error al enviar los datos al servidor.");
                    },
                    dataType: "json"
                });

            });

            $("#detallecap_cerrar").click(function(){
                $("#detallecap").modal("hide");
            });

            $("#selEstadoSol").change(function () {
                var estado = $("#selEstadoSol").val();
                var term = $("#searchinput").val().trim().toUpperCase();
                bloqueointerface();
                location.href = "/adm_aprobarcapdocente?action=participantes&fase={{ fase }}&s="+term+"&eSol="+estado+"&fecharep={{ fecharep }}";
            });

            $("#generar_pdf").click(function () {
                var fechade = $("#id_fecha_de").val();
                var fechahasta = $("#id_fecha_hasta").val();
                var estado = $("#estadosolicitudrepaut").val();
                var tipo = $("#tiporeporte").val();
                var periodo = $("#periodo").val();
                var facultad = $("#facultad").val();

                if(fechade.length==0){
                    smoke.alert("Ingrese la fecha desde");
                    return  false;
                }

                if(fechahasta.length==0){
                    smoke.alert("Ingrese la fecha hasta");
                    return false;
                }

                if(parseInt(periodo) == 0){
                    smoke.alert("Seleccione el periodo");
                    return false;
                }

                if(parseInt(facultad) == 0){
                    smoke.alert("Seleccione una facultad");
                    return false;
                }

                bloqueointerface();

                $.ajax({
                    type: "POST",
                    url: "/adm_aprobarcapdocente",
                    data: {'periodo': periodo, 'facultad': facultad, 'desde': fechade, 'hasta': fechahasta, 'tiporeporte': tipo,'estado': estado, 'action': 'verificalistadosolicitud_pdf'},
                    success: function(data) {
                        if (data.result=='ok') {
                            $.unblockUI();
                            openwindow('POST' ,'/adm_aprobarcapdocente', {action:'listadosolicitud_pdf',periodo: periodo, facultad: facultad, desde: fechade, hasta: fechahasta, estado: estado, tiporeporte: tipo}, '_blank');
                            //$('#itemspanelreporte').modal('hide');
                        } else {
                            $.unblockUI();
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function() {
                        desbloqueoUi();
                        smoke.alert("Error al enviar los datos al servidor.");
                    },
                    dataType: "json"
                });
            });

            $("#cerrar_pdf").click(function () {
                $('#itemspanelreporte').modal('hide');
            });

            $(".reporte_pdf").click(function () {
                $(".panelbody").html();
                tiporep=$(this).attr('tipo');
                $("#tiporeporte").val(tiporep);
                $("#periodo").val(0);
                $("#facultad").val(0);
                $("#estadosolicitudrepaut").val(4);

                $("#itemspanelreporte").modal({backdrop:'static', width: '450px'}).modal('show');
            });


            $(".autorizardesembolso").click(function() {
                var id = $(this).attr('idt');
                $("#id").val(id);
                $("#id_estadodes").val(6).trigger("change");
                $("#autorizardesembolso").modal({backdrop:'static', width: '450px', height: '150px'}).modal('show');
            });

            $(".cerrarmodal").click(function() {
                $("#autorizardesembolso").modal("hide");
                return false;
            });

            $(".btn-aprobarcerrar").click(function() {
                envioformulario("/adm_aprobarcapdocente", false, $("#autorizardesembolso"));
                return false;
            });

            $("form").validationEngine({autoHidePrompt:true, autoHideDelay:1000 });

            envioformulario = function(action, destino, modal){
                var valid = $("form").validationEngine('validate');
                //alert("EnvioForm");
                if (valid){
                    $('.bootstrap-timepicker-widget').css({"display": "none"});
                    bloqueointerface();
                    $('.controls input').each(function(){
                        if ($(this).attr('type')=='text'){
                            $(this).val($(this).val().trim());
                        }
                        if ($(this).attr('type')!='file'){
                            if ($(this).css('text-transform')=='uppercase'){
                                if ($(this).attr('type')!='password'){
                                    $(this).val($(this).val().toUpperCase());
                                }
                            }
                        }
                    });

                    var formdata = new FormData($("#formulario2")[0]);
                    $.ajax({
                        type: "POST",
                        url: action,
                        data: formdata,
                        success: function(data) {
                            ////modal.modal("hide");
                            if (data.result == 'ok') {
                                if(destino){
                                    location.href = destino;
                                }
                                else {
                                    location.reload()
                                }
                            } else {
                                $.unblockUI();
                                smoke.alert(data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            smoke.alert("Error al enviar los datos.");
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                } else {
                    setTimeout(function() {
                        $('.help-text').html("");
                    }, 8000);
                    $.unblockUI();
                }
            };
            
            $(".actualizararchivodesembolso").click(function() {
                var id = $(this).attr('id');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_aprobarcapdocente",
                    data: {'action': 'actualizardesembolso', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodyactualizardesembolso").html(data.data);
                            $(".paneltitleactualizardesembolso").html(data.title);
                            $("#itemspanelactualizardesembolso").modal({backdrop:'static', width: '700px'}).modal('show');
                        } else {
                            mensajeErrorSwal("No se puede consultar", data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error al enviar los datos");
                    },
                    dataType: "json"
                });
            });

            $("#itemspanelactualizardesembolso .guardar").click(function () {
                envioformularioreg("/adm_aprobarcapdocente","actualizardesembolso", false);
                return false;
            });

            $("#itemspanelactualizardesembolso .cerrar").click(function () {
                $('#itemspanelactualizardesembolso').modal('hide');
            });

            $("#itemspanelactualizardesembolso .cerrar2").click(function () {
                $('#itemspanelactualizardesembolso').modal('hide');
            });

            envioformularioreg = function(url, action, destino){
                var valido;
                if(action == 'actualizardesembolso' ){
                    $("#frmActualizarDesembolso").validationEngine('attach',{ scroll: false });
                    valido = $("#frmActualizarDesembolso").validationEngine('validate', { scroll: false });
                }

                if (valido){
                    bloqueointerface();

                    if(action == 'actualizardesembolso')
                        var formdata = new FormData($("#frmActualizarDesembolso")[0]);

                    $.ajax({
                        type: "POST",
                        action : action,
                        url: url,
                        data:  formdata,
                        success: function(data) {
                            if (data.result == 'ok') {
                                $.unblockUI();
                                urlDestino = "/adm_aprobarcapdocente?action=participantes&fase=DES&s=&eSol={{ estadosol }}&fecharep={{ fecharep }}";
                                mensajeSuccessSwal(data.titulo, data.mensaje, urlDestino);
                            } else {
                                $.unblockUI();
                                if(data.swalType == 'warning')
                                    mensajeWarningSwal(data.titulo, data.mensaje);
                                else
                                    mensajeErrorSwal(data.titulo, data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            mensajeErrorSwal("No se puede guardar", "Error al enviar los datos");
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                }else{
                    setTimeout(function() {
                        $('.help-text').html("");
                    }, 8000);
                }
            };


            

        });


        function imprimelistadosolicitudes(){
            if(parseInt($("#totalreg").val())==0)
                smoke.alert("No hay registros de solicitudes para generar el reporte");
            else
                openwindow('POST' ,'/adm_aprobarcapdocente', {action:'listadosolicitud_pdf',estado: $("#selEstadoSol").val(), s: $("#searchinput").val().trim().toUpperCase()}, '_blank');
        }

    </script>
{% endblock %}
{% block atras %}/adm_aprobarcapdocente{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span12'>
            <h4>{{ title }} </h4>
        </div>
    </div>
    <div class='row-fluid'>
        <div class='span4'>
            {% if fase == 'AUT' %}
                <input type="hidden" id="tiporeporte" name="tiporeporte" value="" />
                <div class="btn-group">
                    <a class="btn btn-info dropdown-toggle" data-toggle="dropdown" href="javascript:;">Reportes <span class="caret"></span></a>
                    <ul class="dropdown-menu pull-left">
                        <li><a href="javascript:;" class="reporte_pdf" tipo="AUT" ><i class="fa fa-table"></i> Reporte de Solicitudes autorizadas</a></li>
                        {#                    <li><a href="javascript:;" class="reporte_pdf" tipo="GEN" ><i class="fa fa-table"></i> Reporte General de Solicitudes</a></li>#}
                    </ul>
                </div>
            {% endif %}

            <div class="btn-group">
                <a class="btn btn-success dropdown-toggle" data-toggle="dropdown" href="javascript:;">Documentación <span class="caret"></span></a>
                <ul class="dropdown-menu pull-left">
                    <li><a href="https://sga.unemi.edu.ec/media/capacitacion/resolucion.pdf" target="_blank" ><i class="fa fa-file"></i> Resolución OCAS</a></li>
                    <li><a href="https://sga.unemi.edu.ec/media/capacitacion/instructivo.pdf" target="_blank" ><i class="fa fa-file"></i> Instructivo de capacitación/actualización</a></li>
                    <li><a href="https://sga.unemi.edu.ec/media/capacitacion/manualusuario.pdf" target="_blank" ><i class="fa fa-file"></i> Manual de usuario</a></li>
                </ul>
            </div>

        </div>
        <div class='span4'>
            <b>Tipo:</b>
            <select id="seltipoautoridad" name="seltipoautoridad">
                {% for ntipo in listatipos %}
                    <option value="{{ ntipo.0 }}" >{{ ntipo.1 }}</option>
                {% endfor %}
            </select>
        </div>
        <div class='span4'>
            <b>Estado de Solicitud:</b>
            <select id="selEstadoSol" name="selEstadoSol">
                <option value="0" {% if estadosol == 0 %} selected{% endif %}>TODOS</option>
                {% for e in estados %}
                    <option value="{{ e.0 }}" {% if estadosol == e.0 %}selected{% endif %}>{{ e.1 }}</option>
                {% endfor %}
            </select>
        </div>

    </div>
    <div class='row-fluid'>
        <div class='span12'>
            <form class="form-search" onsubmit="return busqueda()">
                <input class='searchinput' type='text' id='searchinput' value='{{ search }}' autocomplete="off"/>
                <a href="javascript:;" id='search' class='btn btn-info'><i class="fa fa-search "></i> Buscar</a>
                {% if search %}
                    <a href="/adm_aprobarcapdocente?fase={{ fase }}" id='allresults{% if action %}&action=participantes{% endif %}' class='btn btn-info'><i class="fa fa-refresh "></i> Todos</a>
                {% endif %}
            </form>
        </div>
    </div>

    <div class='row-fluid'>
        <div class='span12'>
            <table class='table table-striped table-bordered'>
                <thead>
                <tr>
                    <th style="width: 80px;text-align: center" title="Fecha y número de Solicitud">Fecha/Núm</th>
                    <th style="width: 180px; text-align:center">Nombre</th>
                    <th style="width: 250px; text-align:center">Tema / Institución</th>
                    <th style="width:200px;text-align: center">Justificación</th>
                    <th style="width:80px;text-align: center">Modalidad</th>
                    <th style="width:80px;text-align: center">Fechas</th>
                    <th style="width: 80px; text-align: center">Horas</th>
                    <th style="width:80px;text-align: center">Costo</th>
                    <th style="width:50px;text-align: center">Estado</th>
                    <th style="width:50px;text-align: center">Link</th>
                    <th style="text-align: center; width: 50px;">Archivos</th>
                    <th style="width: 80px; text-align: center">Acciones</th>
                </tr>
                </thead>
                <tbody>
                {% for par in participantes %}
                    <tr>
                        <td style="text-align: center">{{ par.fecha_creacion|date:"Y-m-d"}}<br>
                            <span class="label label-success tu" title="Número de solicitud">&nbsp;&nbsp;{{ par.id|stringformat:"06d" }}&nbsp;&nbsp;</span>
                        </td>
                        <td>{{ par.profesor}}</td>
                        <td>{{ par.tema }}<br>{{ par.institucion }}
                            {% if par.pais %}
                                <br><span class="label label-info">{{ par.pais }}</span>
                            {% endif %}
                        </td>
                        <td>{{ par.justificacion }}</td>
                        <td style="text-align: center">{{ par.get_modalidad_display }}</td>
                        <td style="text-align: center">
                            {% if par.fechainicio and par.fechafin %}
                                {{ par.fechainicio|date:"Y-m-d" }}<br> {{ par.fechafin|date:"Y-m-d" }}
                            {% else %}
                                <span class="label label-warning tu" title="El solicitante debe completar la información"><i class="fa fa-warning"></i> Campo incompleto</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center">{{ par.horas|default_if_none:"" }}</td>
                        <td style="text-align: center">$
                            {% if par.costoneto > 0 %}
                                {{ par.costoneto }}
                            {% else %}
                                {{ par.costo }}
                            {% endif %}
                            {% if par.fechadesembolso %}
                                <span class="label label-info tu" title="Fecha de desembolso">&nbsp;&nbsp;{{ par.fechadesembolso|date:"Y-m-d" }}&nbsp;&nbsp;</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center">
                            {% if par.estado == 1 %}
                                <span cest="{{ par.estado }}" id="estado_solicitud_{{ par.id }}" class="label label-default">{{ par.get_estado_display }}</span>
                            {% elif par.estado == 2 or par.estado == 4 %}
                                <span cest="{{ par.estado }}" id="estado_solicitud_{{ par.id }}" class="label label-info">{{ par.get_estado_display }}</span>
                            {% elif par.estado == 3 %}
                                <span cest="{{ par.estado }}" id="estado_solicitud_{{ par.id }}" class="label label-inverse">{{ par.get_estado_display }}</span>
                            {% elif par.estado == 5 %}
                                <span cest="{{ par.estado }}" id="estado_solicitud_{{ par.id }}" class="label label-warning">{{ par.get_estado_display }}</span>
                            {% elif par.estado == 6 or par.estado == 13 or par.estado == 15 %}
                                <span cest="{{ par.estado }}" id="estado_solicitud_{{ par.id }}" class="label label-success">{{ par.get_estado_display }}</span>
                            {% else %}
                                <span cest="{{ par.estado }}" id="estado_solicitud_{{ par.id }}" class="label label-important">{{ par.get_estado_display }}</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center"><a class="btn btn-warning btn-mini" target="_blank" href="{{ par.link }}"><i class="fa fa-link"></i></a></td>

                        <td style="text-align: center;">
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Solicitud&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
                            <table class='table table-bordered' cellpadding="0" cellspacing="0" style="margin: 0px">
                                <tr>
                                    <td style="width: 25%; text-align: center">
                                        {% if par.archivo %}
                                            <a target="_blank" title="Archivo de referencia" href="{{ par.archivo.url }}" class="btn btn-success btn-mini tu"><i class="fa fa-download"></i> </a>
                                        {% endif %}
                                        {% if par.archivoconvenio %}
                                            {% if par.archivoconveniofirmadovice %}
                                                <a target="_blank" title="Convenio de devengación firmado por vicerrector" href="{{ par.archivoconveniofirmadovice.url }}" class="btn btn-info btn-mini tu"><i class="fa fa-download"></i><i class="fa fa-check"></i> </a>
                                            {% else %}
                                                <a target="_blank" title="Convenio de devengación" href="{{ par.archivoconvenio.url }}" class="btn btn-info btn-mini tu"><i class="fa fa-download"></i> </a>
                                            {% endif %}
                                        {% endif %}
                                        {% if par.archivodesembolso %}
                                            <a target="_blank" title="Desembolso" href="{{ par.archivodesembolso.url }}" class="btn btn-warning btn-mini tu"><i class="fa fa-download"></i> </a>
                                        {% endif %}
                                        {% if par.archivodevolucion %}
                                            <a target="_blank" title="Devolución" href="{{ par.archivodevolucion.url }}" class="btn btn-danger btn-mini tu"><i class="fa fa-download"></i> </a>
                                        {% endif %}
                                        {% if par.archivodescuentorol %}
                                            <a target="_blank" title="Descuento ROL" href="{{ par.archivodescuentorol.url }}" class="btn btn-danger btn-mini tu"><i class="fa fa-download"></i> </a>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>

                            {% if par.archivoinforme or par.archivofactura or par.archivocertificado %}
                                Evidencias<br>
                                <table class='table table-bordered' cellpadding="0" cellspacing="0" style="margin: 0px">
                                    <tr>
                                        <td style="width: 25%; text-align: center">
                                            {% if par.archivoinforme %}
                                                <a target="_blank" title="Informe" href="{{ par.archivoinforme.url }}" class="btn btn-success btn-mini tu"><i class="fa fa-download"></i> </a>
                                            {% endif %}
                                            {% if par.archivofactura %}
                                                <a target="_blank" title="Factura" href="{{ par.archivofactura.url }}" class="btn btn-info btn-mini tu"><i class="fa fa-download"></i> </a>
                                            {% endif %}
                                            {% if par.archivocertificado %}
                                                <a target="_blank" title="Certificado" href="{{ par.archivocertificado.url }}" class="btn btn-warning btn-mini tu"><i class="fa fa-download"></i> </a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </table>
                            {% endif %}
                        </td>


                        <td style="text-align: center">
                        {% if not persona.id == par.profesor.persona_id %}
                            {% if fase != 'DES' %}
                                {% if not par.numeroconvenio %}
                                    <a title="Aprobar solicitud" class="informacioncap btn btn-success btn-mini"  idt="{{par.id}}" soli_director="{{ par.soli_director }}" soli_decano="{{ par.soli_decano }}" soli_vicerrec="{{ par.soli_vicerrec }}" href="javascript:;" ><i class="fa fa-check-square"></i></a>
                                {% endif %}
                            {% elif par.estado == 5 %}
                                <a title="Autorizar desembolso" class="autorizardesembolso btn btn-success btn-mini" idt="{{par.id}}" href="javascript:;" ><i class="fa fa-check-square"></i></a>
                            {% endif %}
                            {% if par.archivodesembolso and fase == 'DES' %}
                                <a title="Actualizar Archivo Desembolso" class="actualizararchivodesembolso btn btn-info btn-mini" id="{{par.id|encrypt}}" href="javascript:;" ><i class="fa fa-edit"></i></a>
                            {% endif %}
                        {% endif %}

                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="13">NO EXISTEN PARTICIPANTES</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class='row-fluid'>
        <div class="span12">
            {% if paging.num_pages > 20 %}
                <div class='pagination'>
                    <ul>
                        {% if paging.primera_pagina %}
                            <li><a href="/adm_aprobarcapdocente?action=participantes&eSol={{ estadosol }}&{% if search %}s={{ search }}&{% endif %}page=1">1</a></li>
                            <li><a href="/adm_aprobarcapdocente?action=participantes&eSol={{ estadosol }}&{% if search %}s={{ search }}&{% endif %}page={{ paging.ellipsis_izquierda }}" class="active">...</a></li>
                        {% endif %}
                        {% for pagenumber in paging.paginas %}
                            <li {%  if pagenumber == page.number %}class='active'{% endif %}><a href="/adm_aprobarcapdocente?action=participantes&eSol={{ estadosol }}&{% if search %}s={{ search }}&{% endif %}page={{ pagenumber }}">{{ pagenumber }}</a></li>
                        {% endfor %}
                        {% if paging.ultima_pagina %}
                            <li><a href="/adm_aprobarcapdocente?action=participantes&eSol={{ estadosol }}&{% if search %}s={{ search }}&{% endif %}page={{ paging.ellipsis_derecha }}" class="active">...</a></li>
                            <li><a href="/adm_aprobarcapdocente?action=participantes&eSol={{ estadosol }}&{% if search %}s={{ search }}&{% endif %}page={{ paging.num_pages }}">{{ paging.num_pages }}</a></li>
                        {% endif %}
                    </ul>
                </div>
            {% else %}
                <div class='pagination'>
                    <ul>
                        {% for pagenumber in paging.page_range %}
                            <li {%  if pagenumber == page.number %}class='active'{% endif %}><a href="/adm_aprobarcapdocente?action=participantes&eSol={{ estadosol }}&{% if search %}s={{ search }}&{% endif %}page={{ pagenumber }}">{{ pagenumber }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="modal fade static" id="detallecap" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">
                {% if fase == 'LEG' %}
                    Legalizar solicitud de capacitación
                {% elif fase == 'VAL' %}
                    Validar solicitud de capacitación
                {% elif fase == 'APR' %}
                    Aprobar solicitud de capacitación
                {% elif fase == 'AUT' %}
                    Autorizar solicitud de capacitación
                {% else %}
                    Autorización de desembolso
                {% endif %}
            </h3>
        </div>
        <div class="modal-body" id="detallecap_body"></div>
        <div class="modal-footer">
            <div style="float: right">
                <td><a href="javascript:;" id="detallecap_guardar" class="btn btn-success"> Guardar</a></td>
                <td><a href="javascript:;" id="detallecap_cerrar" class="btn btn-info"> Cerrar</a></td>
            </div>
        </div>
    </div>

    {#    <div class="modal fade static" id="itemspanelreporte" style="display: none;">#}
    {#        <div class="modal-header">#}
    {#            <h4 class="paneltitle"><span class="fa fa-file-pdf-o"></span> Solicitudes de capacitaciones/actualizaciones</h4>#}
    {#        </div>#}
    {#        <div class="modal-body panelbody">#}
    {##}
    {#            <div class='span2'>#}
    {#                <span>Desde: </span><input type="text" class="selectorfecha" value="{{ fecharep }}" id="id_fecha_de" style="width: 100px;">#}
    {#            </div>#}
    {#            <div class='span2'>#}
    {#                <span>Hasta: </span><input type="text" class="selectorfecha" value="{{ fecharep }}" id="id_fecha_hasta" style="width: 100px; ">#}
    {#            </div><br>#}
    {##}
    {#        </div>#}
    {#        <div class="modal-footer">#}
    {#            <table class="pull-right">#}
    {#                <tr>#}
    {#                    <td><a href="javascript:;" class="btn btn-generar btn-success" id="generar_pdf"><i class="fa fa-file-pdf-o"></i> Generar</a></td>#}
    {#                    <td><a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrar_pdf"><i class="fa fa-close"></i> Cerrar</a></td>#}
    {#                </tr>#}
    {#            </table>#}
    {#        </div>#}
    {#    </div>#}



    <div class="modal fade static" id="itemspanelreporte" style="width:100px;display: none;">
        <div class="modal-header">
            <h4 class="paneltitle"><span class="fa fa-file-pdf-o"></span> Solicitudes de capacitaciones autorizadas</h4>
        </div>
        <div class="modal-body panelbody">
            <div class="row-fluid">
                <div style="height: 35px">
                    <div style="width: 100px; text-align: right; padding-right: 20px; float: left">Desde</div>
                    <div style="float: left"><input type="text" class="selectorfecha" value="{{ fecharep }}" id="id_fecha_de" style="width: 100px" ></div>
                    <div style="width: 100px; text-align: right; padding-right: 20px; float: left">Hasta</div>
                    <div style="float: left"><input type="text" class="selectorfecha" value="{{ fecharep }}" id="id_fecha_hasta" style="width: 100px" ></div>
                </div>

                <div style="height: 35px">
                    <div style="width: 100px; text-align: right; padding-right: 20px; float: left">Periodo:</div>
                    <div style="float: left">
                        <select id="periodo" name="periodo" style="width: 300px;">
                            <option value="0">--Seleccione--</option>
                            {% for p in periodos %}
                                <option value="{{ p.0 }}">{{ p.1 }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div style="height: 35px">
                    <div style="width: 100px; text-align: right; padding-right: 20px; float: left">Facultad:</div>
                    <div style="float: left">
                        <select id="facultad" name="facultad" style="width: 300px;">
                            <option value="0">--Seleccione--</option>
                            {% for e in departamentos %}
                                <option value="{{ e.0 }}">{{ e.1 }} ({{ e.2 }})</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div style="height: 35px">
                    <div style="width: 100px; text-align: right; padding-right: 20px; float: left">Estado:</div>
                    <div style="float: left">
                        <select id="estadosolicitudrepaut" name="estadosolicitudrepaut" style="width: 300px;">
                            <option value="0">TODOS</option>
                            <option value="4">AUTORIZADO</option>
                            <option value="9">DENEGADO</option>
                            <option value="3">APROBADO(O POR AUTORIZAR)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <table class="pull-right">
                <tr>
                    <td><a href="javascript:;" class="btn btn-generar btn-success" id="generar_pdf"><i class="fa fa-file-pdf-o"></i> Generar</a></td>
                    <td><a href="javascript:;" class="btn btn-cerrar btn-info" id="cerrar_pdf"><i class="fa fa-close"></i> Cerrar</a></td>
                </tr>
            </table>
        </div>
    </div>




    <div id="mensajeValidaSolicitud" style="display:none">El Director de carrera por medio de sistema informático institucional, validará o no las solicitudes
        de actualización en función de los criterios y compromisos aceptados por el solicitante y que la fecha de terminación del programa
        solicitado no sea posterior al mes de Septiembre del año en curso; en caso de no validar la solicitud registrará las razones en comentarios
        , lo que será conocido por el personal académico.<br><br>Int. De Capacitación y Actualización Art. 37</div>
    <div id="mensajeApruebaSolicitud" style="display:none">Una vez validada la actualización, el Decano en observancia de esta institución, aprobará el programa de actualización.
        <br><br>Int. De Capacitación y Actualización Art. 37</div>
    <div id="mensajeAutorizaSolicitud" style="display:none">
       Debiendo el Vicerrectorado de Investigación y Posgrado como última instancia,
        autorizar la participación del personal académico en el evento de capacitación
        o actualización científica que solicitó.
        <br><br>Reglam. de Becas art. 54 </div>


    <div class="modal fade static" id="autorizardesembolso" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent;">
                <tr>
                    <td style="width: 80%"><h3 class="paneltitlearchivo">Autorizar desembolso</h3></td>
                </tr>
            </table>
        </div>
        <form id="formulario2" style="width: 100%; margin-bottom: 0px;padding-left: 15px;padding-top: 10px; padding-right: 15px; padding-bottom: 0px">
            <div class="row-fluid">
                <input type='hidden' name='action' value='autorizardesembolso' />
                <input type='hidden' name='id' id="id" value='0' />
                {% for field in form2 %}
                    {% if field.field.widget.attrs.separator %}
                        <div style="width: 100%; height: 1px; float: left;"></div>
                    {% endif %}
                    <fieldset class="control-group nomargins" style="float: left; width: {% if field.field.widget.attrs.formwidth %}{{ field.field.widget.attrs.formwidth }}{% else %}100%{% endif %}">
                        <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                        <div class="controls">
                            {{ field }}
                            <p class="help-text">{{ field.help_text }} </p>
                        </div>
                    </fieldset>
                {% endfor %}
            </div>
        </form>
        <div class="modal-footer">
            <td id="aprobarcerrar"><a href="javascript:;" class="btn btn-aprobarcerrar btn-success"> Guardar</a></td>
            <a href="javascript:;" class="btn btn-info cerrarmodal">Cerrar</a>
        </div>
    </div>
    
    <div class="modal fade static"  data-keyboard="false" id="itemspanelactualizardesembolso" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent">
                <tr>
                    <td style="width: 80%"><h4 class="paneltitleactualizardesembolso">Título del Modal</h4></td>
                    <td><a href="javascript:;" title="Cerrar" class="btn btn-danger btn-mini pull-right cerrar2"><i class="fa fa-remove"></i></a></td>
                </tr>
            </table>
        </div>
        <div class="modal-body panelbodyactualizardesembolso">
        </div>
        <div class="modal-footer" style="text-align: right">
            <a href="javascript:;" class="btn btn-success guardar"> Guardar</a>
            <a href="javascript:;" class="btn btn-danger cerrar"> Cancelar</a>
        </div>
    </div>

{% endblock %}