{% extends "basebs.html" %}
{% load sga_extras %}
{% load humanize %}
{% block heading %}
    <link href="/static/css/table-responsive.css?1.0.0" type="text/css" rel="stylesheet" />
    <style>
        .dialog-buttons button {
            background-color: #6dbb4a;
            border-color: #6dbb4a;
            color: #FFFFFF;
        }
        .dialog-buttons button.cancel {
            background-color: #ec6459;
            border-color: #ec6459;
            color: #FFFFFF;
        }
        .smoke {
            background-color: #f5f5f5;
        }
    </style>
    <script>
        var busqueda = function(page/*=undefined*/){
            var term = $("#searchinput").val().trim().toUpperCase();
            page = typeof page == 'undefined' ? 1 : page;
            if(term.length>0){
                bloqueointerface();
                location.href = `/adm_convalidacionpractica?action=listarinscritos&s=${term}&id={{ actividad.id }}&op=0`;
            }
            else{
                bloqueointerface();
            }
            return false;
        };
        $(function() {
            $("select").select2({minimumResultsForSearch: 5 });

             $("#search").click(function() {
                busqueda();
            });

            $('#searchinput').keyup(function(e) {
                if(e.keyCode == 13) {
                    busqueda();
                }
            });

            {#busqueda = function () {#}
            {#    location.href = "/adm_convalidacionpractica?action=listarinscritos&s="+$("#searchinput").val().toUpperCase()+"&id="+{{ actividad.id }};#}
            {#};#}

            $(".revisararchivos").click(function () {
                var id = $(this).attr('id');
                var op = $(this).attr('op');

                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/adm_convalidacionpractica",
                    data: {'action': 'cargararchivosinscritos', 'id': id, 'op': op},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodyrevisararchivos").html(data.data);
                            $(".paneltitlerevisararchivos").html(data.title);
                            $("#itemspanelrevisararchivos").modal({
                                backdrop: 'static',
                                width: '80%',
                                height: '580px'
                            }).modal('show');
                        } else {
                            smoke.alert(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "json"
                });
            });

             $("#itemspanelrevisararchivos .cerrar").click(function () {
                $('#itemspanelrevisararchivos').modal('hide');
            });

            $("#itemspanelrevisararchivos .cerrar2").click(function () {
                $('#itemspanelrevisararchivos').modal('hide');
            });

            $("#itemspanelrevisararchivos .guardar").click(function () {
                if (!datosregistrocumplimientocompletos())
                    return false;

                var tp = 0, ta = 0, tr = 0;
                $('select[name="estadoregistro[]"]').each(function () {
                    valor = parseInt($(this).val());

                    if (valor == 0)
                        tp++;
                    else if (valor == 6)
                        ta++;
                    else
                        tr++;
                });

                msg = "¿Está seguro de guardar el Registro de Cumplimiento de la siguiente manera?\n";
                msg = msg + "APROBADOS: " + ta.toString() + ", "
                msg = msg + "REPROBADOS: " + tr.toString()

                smoke.confirm(msg, function (e) {
                        if (e) {
                            envioformularioreg("/adm_convalidacionpractica", "revisararchivos", false);
                            return false;
                        }
                    }, {
                        ok: "SI, GUARDAR",
                        cancel: "NO, CANCELAR",
                        classname: "custom-class",
                        reverseButtons: true
                    }
                );
            });
        });
    </script>
{% endblock %}
{% block canvas %}
    <div id="no-more-tables"><!-- inicio no more tables-->
        <div class='row-fluid'>
        <div class='span12'>
            <h4>{{ title }}</h4><br>
            <h4>TIPO: {{ actividad.get_tipoactividad_display }}</h4>
            <h4>ACTIVIDAD: {{ actividad.titulo }}</h4>
            <h4>LIDER: {{ actividad.profesor }}</h4>
        </div>
    </div>
    </div>

    <div id="no-more-tables"><!-- inicio no more tables-->
        <div class='row-fluid'>
        <div class="span12">
            <table id="tablaBusqueda" class="table table-hover tablaBusquedaSearch">
                <tbody>
                    <tr>
                        <td>
                            <form class="form-search" onsubmit="return busqueda()">
                                <input class='searchinput' type='text' id='searchinput' value='{{ search }}' autocomplete="off" placeholder="BUSCAR ESTUDIANTE"/>
                                <a href="javascript:;" id='search' class='btn btn-info'><i class="fa fa-search "></i></a>
                                {% if search or ids %}
                                    <a href="/adm_convalidacionpractica?action=listarinscritos&id={{ actividad.id }}&op=0" id='allresults'  class='btn btn-info'><span class="fa fa-refresh " ></span> Todos</a>
{#                                    <a href="javascript:;" class='btn btn-mini btn-inverse tu action_clean' title="Limpiar"><span class="fa fa-remove"></span></a>#}
                                {% endif %}
                            </form>
                        </td>
                    </tr>

                </tbody>
            </table>
        </div>
{#                <form method="GET" action="{{ request.path }}">#}

    </div>
    </div>

    <div id="no-more-tables"><!-- inicio no more tables-->
        <div class='row-fluid'>
        <div class='span12'>
            <label class="label label-default"><i class="fa fa-ticket"></i> {{ actividad.cupo }} CUPOS ASIGNADOS</label>
            <label class="label label-inverse"><i class="fa fa-user-plus"></i> {{ actividad.total_alumnos_preinscritos }} PREINSCRITOS</label>
            <label class="label label-success"><i class="fa fa-users"></i> {{ actividad.total_alumnos_inscritos }} INSCRIPCIONES ACEPTADAS</label>
            <label class="label label-info"><i class="fa fa-ticket"></i> {{ actividad.total_cupo_disponible }} CUPOS DISPONIBLES</label>
            {% with estado=actividad.estado %}
                <label class="label label-{% if estado == 1 %}info
                                                {% elif estado == 2 %}inverse
                                                {% elif estado == 3 %}default
                                                {% elif estado == 4 or estado == 7 %}warning
                                                {% elif estado == 6 or estado == 8 or estado == 9 %}success
                                                {% else %}important {% endif %}">ESTADO DE ACTIVIDAD: {{ actividad.get_estado_display }}</label>
            {% endwith %}
        </div>
    </div>
    </div>

    <div id="no-more-tables">
        <div class="row-fluid">
            <div class='span12'>
                <table class='table table-bordered' cellpadding="0" cellspacing="0">
                    <thead>
                    <tr>
                        <th style="width: 5%; text-align: center;">#</th>
                        <th style="width: 35%; text-align: center;"><i class="fa fa-users"></i> Datos de Estudiante</th>
                        <th style="width: 20%; text-align: center;">Carrera</th>
                        <th style="width: 10%; text-align: center;">Nivel</th>
                        <th style="width: 10%; text-align: center;">Datos de Actividad</th>
                        <th style="width: 5%; text-align: center;">Estado</th>
                        <th style="width: 5%; text-align: center;">Archivos</th>
                    </tr>
                    </thead>

                    <tbody>
                    {% for inscrito in inscritos %}
                        <tr>
                            <td style="text-align: center"><strong>{{ forloop.counter }}</strong></td>
                            <td style="text-align: justify">
                                <i class="fa fa-user"></i> {{ inscrito.inscripcion.persona }}<br>
                                <i class="fa fa-address-card"></i> {{ inscrito.inscripcion.persona.identificacion }}
                                <br>
                                <i class="fa fa-envelope"></i> {{ inscrito.inscripcion.persona.emailinst }} <br>
                                <label class="label label-inverse">Cod. {{ inscrito.pk }}</label>
                            </td>
                            <td style="text-align: left">
                                {{ inscrito.inscripcion.carrera }}
                            </td>
                            <td style="text-align: center">
                                {{ inscrito.inscripcion.mi_nivel }}
                            </td>
                            <td style="text-align: center">
                                <label>HORAS CUMPLIDAS: <span class="badge badge-success">{{ inscrito.cargadosrequisitos }}</span></label>
                                {% if inscrito.cantidad_archivos %}
                                    <label>ARCHIVOS SUBIDOS: <span class="badge badge-info">{{ inscrito.cantidad_archivos }}</span></label>

                                {% else %}
                                    <label class="label label-warning">NO REGISTRA ARCHIVOS SUBIDOS</label>

                                {% endif %}

                                {% if inscrito.requisitos_pendientes %}
                                    <label>ARCHIVOS PENDIENTES POR REVISAR: <span class="badge badge-warning">{{ inscrito.requisitos_pendientes }}</span></label>

                                {% endif %}
                                {% if inscrito.cantidad_archivos_corregidos %}
                                    <label>ARCHIVOS POR CORREGIR: <span class="badge badge-info">{{ inscrito.cantidad_archivos_corregidos }}</span></label>
                                {% else %}

                                {% endif %}
                            </td>
                            <td style="text-align: center">
                                {% with estado=inscrito.estado %}
                                    <span class="label label-{% if estado == 1 %}inverse{% elif estado == 2 %}info{% elif estado == 3 or estado == 7 %}important{% elif estado == 4 %}warning{% elif estado == 5 %}default{% else %}success{% endif %}">{{ inscrito.get_estado_display }}</span>
                                {% endwith %}
                            </td>
                            <td style="text-align: center">
{#                                <a href="javascript:;" id="{{ inscrito.id }}" aid="{{ actividad.id }}"#}
{#                                   class="btn btn-warning mostrararchivos" title="Mostrar Archivos"><i#}
{#                                        class="fa fa-archive"></i></a>#}


                                <div class="btn-group" style="text-align: left">
                                    <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="javascript:;">Acciones<span
                                            class="caret"></span>
                                    </a>
                                    <ul class="dropdown-menu pull-right">
                                        <li><a href="javascript:;" id="{{ inscrito.id }}" op = "{{ opcion }}"aid="{{ actividad.id }}" class="revisararchivos" >
                                            <i class='fa fa-archive'></i> Revisar archivos </a></li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="5" style="text-align: center">NO EXISTEN ESTUDIANTES INSCRITOS A LA ACTIVIDAD
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="itemspanelrevisararchivos" style="display: none;">
        <div class="modal-header">
            <table border="0" width="100%" style="background-color: transparent">
                <tr>
                    <td style="width: 80%"><h4 class="paneltitlerevisararchivos">Revisar y Validar Contrato de
                        Beca</h4></td>
                    <td><a href="javascript:;" title="Cerrar" class="btn btn-danger btn-mini pull-right cerrar2"><i
                            class="fa fa-remove"></i></a></td>
                </tr>
            </table>
        </div>
        <div class="modal-body panelbodyrevisararchivos">
        </div>
        <div class="modal-footer" style="text-align: right">
{#            <a href="javascript:;" class="btn btn-success guardar"> Guardar</a>#}
            <a href="javascript:;" class="btn btn-danger cerrar"> Cerrar</a>
        </div>
    </div>
{% endblock %}
{% block atras %}{{ request.path }}{% endblock %}