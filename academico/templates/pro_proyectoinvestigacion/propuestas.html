{% extends "base.html" %}
{% load humanize %}
{% load sga_extras %}
{% block heading %}
    <script type="text/javascript" src='/static/js/jquery.validationEngine.js?v=1.0.0'></script>
    <script type="text/javascript" src='/static/js/jquery.validationEngine-es.js?v=1.0.0' ></script>
    <link type='text/css' rel='stylesheet' href="/static/css/validationEngine.jquery.css?v=1.0.0"/>
    <script type="text/javascript">
        $(function() {
            $('[data-bs-toggle="tooltip"]').on('click', function () {
                $(this).tooltip('hide');
            });

            $("#search").click(function() {
                busqueda();
            });

            $('#searchinput').keyup(function(e) {
                if(e.keyCode == 13) {
                    $("#search").trigger("click");
                }
            });

            busqueda = function () {
                let term = $("#searchinput").val().toUpperCase().trim();
                if (term.length > 0)
                    location.href = "/pro_proyectoinvestigacion?action=propuestas&idc={{ convocatoriaid|encrypt }}&s="+$("#searchinput").val().toUpperCase();
            };

            $(".mostrarrecorrido").click(function() {
                let id = $(this).attr('id');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/pro_proyectoinvestigacion",
                    data: {'action': 'mostrarrecorrido', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".paneltitlerecorrido").html(data.title);
                            $(".panelbodyrecorrido").html(data.data);
                            $("#itemspanelrecorrido").modal({backdrop:'static'}).modal('show');
                        } else {
                            mensajeErrorSwal("No se puede consultar", data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                    },
                    dataType: "json"
                });
            });

            $(".mostrarevaluaciones").click(function() {
                let id = $(this).attr('id');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/pro_proyectoinvestigacion",
                    data: {'action': 'mostrarevaluaciones', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".paneltitleevaluaciones").html(data.title);
                            $(".panelbodyevaluaciones").html(data.data);
                            $("#itemspanelevaluaciones").modal({backdrop:'static'}).modal('show');
                        } else {
                            mensajeErrorSwal("No se puede consultar", data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                    },
                    dataType: "json"
                });
            });

            $(".mostrarnovedad").click(function() {
                mostrarNovedad('{{ convocatoria.id|encrypt }}');
            });

            mostrarNovedad = function (idc){
                let id = idc;
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/pro_proyectoinvestigacion",
                    data: {'action': 'mostrarnovedad', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".paneltitlenovedad").html(data.title);
                            $(".panelbodynovedad").html(data.data);
                            $("#itemspanelnovedad").modal({backdrop:'static'}).modal('show');
                        } else {
                            mensajeErrorSwal("No se puede consultar", data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                    },
                    dataType: "json"
                });
            };

            $(".generardocumento").click(function () {
                let id = $(this).attr('id');
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/pro_proyectoinvestigacion",
                    data: {'action':'generardocumento', 'id': id},
                    success: function(data) {
                        if (data.result == 'ok'){
                            window.open(data.documento, '_blank');
                            location.reload();
                        } else {
                            $.unblockUI();
                            if(data.swalType == 'warning')
                                mensajeWarningSwal(data.titulo, data.mensaje);
                            else
                                mensajeErrorSwal(data.titulo, data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error al enviar los datos");
                    },
                    dataType: "json"
                });
            });

            $(".subirdocumento").click(function() {
                let id = $(this).attr('id');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/pro_proyectoinvestigacion",
                    data: {'action': 'subirdocumento', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodysubirdocumento").html(data.data);
                            $(".paneltitlesubirdocumento").html(data.title);
                            $("#itemspanelsubirdocumento").modal({backdrop:'static'}).modal('show');
                        } else {
                            mensajeErrorSwal("No se puede consultar", data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                    },
                    dataType: "json"
                });
            });

            $("#itemspanelsubirdocumento .guardar").click(function () {
                envioformularioreg("/pro_proyectoinvestigacion", "subirdocumento", false);
                return false;
            });

            envioformularioreg = function(url, action, destino){
                let valido;
                let formdata;
                if(action == 'subirdocumento'){
                    $("#frmSubirDocumento").validationEngine('attach',{ scroll: false });
                    valido = $("#frmSubirDocumento").validationEngine('validate', { scroll: false });
                }
                else if(action == 'editactividadcronograma'){
                    $("#frmEditActividadCronograma").validationEngine('attach',{ scroll: false });
                    valido = $("#frmEditActividadCronograma").validationEngine('validate', { scroll: false });
                }
                else if(action == 'subirpresupuesto'){
                    $("#frmSubirPresupuesto").validationEngine('attach',{ scroll: false });
                    valido = $("#frmSubirPresupuesto").validationEngine('validate', { scroll: false });
                }

                if(valido){
                    bloqueointerface();
                    if(action == 'subirdocumento')
                        formdata = new FormData($("#frmSubirDocumento")[0]);
                    else if (action == 'editactividadcronograma')
                        formdata = new FormData($("#frmEditActividadCronograma")[0]);
                    else if (action == 'subirpresupuesto')
                        formdata = new FormData($("#frmSubirPresupuesto")[0]);

                    $.ajax({
                        type: "POST",
                        action: action,
                        url: url,
                        data: formdata,
                        success: function(data) {
                            if(data.result == 'ok'){
                                $.unblockUI();
                                urlDestino = "/pro_proyectoinvestigacion?action=propuestas&id="+data.id+"&idc={{ convocatoria.id|encrypt }}";
                                mensajeSuccessSwal(data.titulo, data.mensaje, urlDestino);
                            }else{
                                $.unblockUI();
                                if(data.swalType == 'warning')
                                    mensajeWarningSwal(data.titulo, data.mensaje);
                                else
                                    mensajeErrorSwal(data.titulo, data.mensaje);
                            }
                        },
                        error: function() {
                            $.unblockUI();
                            mensajeErrorSwal("No se puede guardar", "Error al enviar los datos")
                        },
                        dataType: "json",
                        cache: false,
                        contentType: false,
                        processData: false
                    });
                }else{
                    setTimeout(function() {
                        $('.help-text').html("");
                    }, 8000);
                    $.unblockUI();
                }
            };

            $(".eliminar").click(function() {
                let id = $(this).attr('id');
                let titulo = $(this).attr('titulo');
                let url = "/pro_proyectoinvestigacion";
                let action = "delpropuestaproyecto";
                let urlDestino = "/pro_proyectoinvestigacion?action=propuestas&idc={{ convocatoria.id|encrypt }}";

                mensajeConfirmSwal("Eliminar Propuesta de Proyecto", "¿Está seguro de eliminar la propuesta de proyecto de investigación con el título "+titulo+"?", true, url, action, id, urlDestino);
            });

            $(".habilitar").click(function() {
                let id = $(this).attr('id');
                let titulo = $(this).attr('titulo');
                let url = "/pro_proyectoinvestigacion";
                let action = "habilitaredicion";
                let urlDestino = "/pro_proyectoinvestigacion?action=propuestas&idc={{ convocatoria.id|encrypt }}";

                mensajeConfirmSwal("Habilitar Edición de Propuesta de Proyecto", "¿Está seguro de habilitar la edición de información para la propuesta de proyecto de investigación con el título "+titulo+"?", true, url, action, id, urlDestino);
            });

            $(".subirpresupuesto").click(function() {
                let id = $(this).attr('id');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: "/pro_proyectoinvestigacion",
                    data: {'action': 'subirpresupuesto', 'id': id},
                    success: function(data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            $(".panelbodysubirpresupuesto").html(data.data);
                            $(".paneltitlesubirpresupuesto").html(data.title);
                            $("#itemspanelsubirpresupuesto").modal({backdrop:'static'}).modal('show');
                        } else {
                            mensajeErrorSwal("No se puede consultar", data.mensaje);
                        }
                    },
                    error: function() {
                        $.unblockUI();
                        mensajeErrorSwal("No se puede consultar", "Error al enviar los datos")
                    },
                    dataType: "json"
                });
            });

            $("#itemspanelsubirpresupuesto .guardar").click(function () {
                envioformularioreg("/pro_proyectoinvestigacion", "subirpresupuesto", false);
                return false;
            });

            {% if existenovedad %}
                mostrarNovedad('{{ convocatoria.id|encrypt }}');
            {% endif %}

        });
    </script>
{% endblock %}
{% block atras %}/pro_proyectoinvestigacion?action=convocatorias{% endblock %}
{% block canvas %}
    {# TITULO PANTALLA #}
    <div class='row'>
        <div class='col-lg-12'>
            <div class="headtitle">
                <h3 class="texto-blue">{{ title }}</h3>
                <h6>Propuestas de Docentes (Convocatoria: {{ tituloconvocatoria }})</h6>
            </div>
        </div>
    </div>
    {# TITULO PANTALLA #}

    <div class="container-fluid">
        {# FILA DE MENSAJE #}
        {% if convocatoria.vigente %}
            {% if mostrarboton or mensaje %}
                <div class='row'>
                    <div class="col-sm-12 pb-2">
                        {% if mostrarboton %}
                            <a href="/pro_proyectoinvestigacion?action=addpropuestaproyecto&idc={{ convocatoria.id|encrypt }}" class='btn btn-success tu' title="Agregar Propuesta de proyecto"><span class="fa fa-plus" ></span> Agregar</a>
                        {% else %}
                            {% if mensaje %}
                                <div class="{{ clasemsg }}">
                                    <strong>{{ mensaje|safe }}</strong>
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endif %}
        {# FILA DE MENSAJE #}
        {# FILA DE MENSAJE #}
        {% if not proyectos and not mensaje %}
            <div class='row'>
                <div class="col-sm-12 pb-2">
                    <div class="alert alert-info" style="text-align: justify"><strong>Nota:</strong> Los docentes que deseen dirigir o co-dirgir un proyecto de investigación, deben estar registrados en el Sistema de Registro, Acreditación y Categorización de Investigadores Nacionales y Extranjeros de la Senescyt.</div>
                </div>
            </div>
        {% endif %}
        {# FILA DE MENSAJE #}
        {# FILA DE FILTRO #}
        <div class='row'>
            <div class="col-sm-8 pb-2">

            </div>
            <div class="col-sm-4 pb-2">
                <div class="input-group mb-2">
                    <input type="text" class="form-control" autocomplete="off" placeholder="Título del proyecto" aria-label="Buscar" id='searchinput' name="s" value="{{ s }}">
                    <div class="input-group-append">
                        <button class="btn btn-primary" id="search" type="button"><i class="fa fa-search"></i></button>
                        {% if url_vars %}
                            {% if s or ids %}
                                <a title="Ver todo" href="{{ request.path }}?action=propuestas&idc={{ convocatoriaid|encrypt }}" class="btn btn-default tr"><i class="fas fa-sync-alt"></i></a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {# FILA DE FILTRO #}
        {# TABLA DE DATOS #}
        <div class="card mb-4">
            <div class="card-body border-top border-6 rounded-3 border-dark-info">
                <div class="table-responsive-xxl">
                    <table class='table table-bordered table-striped'>
                        <thead class="table-light cabecera-fija">
                            <tr>
                                <th style="width: 7%; font-weight: bold; text-align: center">F.Registro</th>
                                <th style="width: 10%; font-weight: bold; text-align: center">Categoría</th>
                                <th style="width: 31%; font-weight: bold; text-align: center">Título/Línea</th>
                                <th style="width: 5%; font-weight: bold; text-align: center">Descarg.</th>
                                <th style="width: 10%; font-weight: bold; text-align: center">Tiempo ejecución</th>
                                <th style="width: 7%; font-weight: bold; text-align: center">Tipo/Cobertura</th>
                                <th style="width: 7%; font-weight: bold; text-align: center">Monto Financiamiento</th>
                                <th style="width: 7%; font-weight: bold; text-align: center">Presupuesto</th>
                                <th style="width: 10%; font-weight: bold; text-align: center">Estado</th>
                                <th style="width: 5%; font-weight: bold; text-align: center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for proyecto in proyectos %}
                                {% with rolparticipante=proyecto|args:persona|call:"rol_participante" %}
                                    <tr>
                                        <td style="text-align: center">{{ proyecto.fecha_creacion|date:"d-m-Y" }}</td>
                                        <td style="text-align: center;">
                                            {{ proyecto.categoria2.descripcion }}
                                        </td>
                                        <td style="text-align: justify">
                                            {{ proyecto.titulo }}<br>
                                            <b>{{ proyecto.lineainvestigacion.nombre }}</b>
                                            <br>
                                            <strong>Rol cumplido:</strong> <span class="label label-warning">{{ rolparticipante.descripcion }}</span>
                                        </td>
                                        <td data-title="Descargas:" style="text-align: center">
                                            {% if proyecto.archivopresupuesto %}
                                                <a href="{{ proyecto.archivopresupuesto.url }}" class="btn btn-mini btn-info" data-width="2048" data-height="1380" data-fancybox="presupesto{{ proyecto.id }}" data-caption="Presupuesto Final" data-bs-toggle="tooltip" data-placement="top" title="Presupuesto Final"><i class="fa fa-eye"></i> </a>
                                            {% endif %}
                                            {% if proyecto.archivoproyecto %}
                                                <a href="{{ proyecto.archivoproyecto.url }}" class="btn btn-mini btn-info" data-width="2048" data-height="1380" data-fancybox="proyecto{{ proyecto.id }}" data-caption="Archivo del Proyecto" data-bs-toggle="tooltip" data-placement="top" title="Archivo del Proyecto"><i class="fa fa-eye"></i> </a>
                                            {% endif %}
                                            {% if proyecto.documentogenerado %}
                                                <a href="{{ proyecto.archivodocumento.url }}" class="btn btn-mini btn-success" data-width="2048" data-height="1380" data-fancybox="formatosinfirmar{{ proyecto.id }}" data-caption="Formato Inscripción" data-bs-toggle="tooltip" data-placement="top" title="Formato Inscripción"><i class="fa fa-eye"></i> </a>
                                            {% endif %}
                                            {% if proyecto.archivodocumentofirmado %}
                                                <a href="{{ proyecto.archivodocumentofirmado.url }}" class="btn btn-mini btn-warning" data-width="2048" data-height="1380" data-fancybox="formatofirmado{{ proyecto.id }}" data-caption="Formato Inscripción Firmado" data-bs-toggle="tooltip" data-placement="top" title="Formato Inscripción Firmado"><i class="fa fa-eye"></i> </a>
                                            {% endif %}
                                            {% if proyecto.archivoanulacion %}
                                                <a href="{{ proyecto.archivoanulacion.url }}" class="btn btn-mini btn-danger" data-width="2048" data-height="1380" data-fancybox="anulacion{{ proyecto.id }}" data-caption="Respaldo Anulación de Proyecto" data-bs-toggle="tooltip" data-placement="top" title="Respaldo Anulación del Proyecto"><i class="fa fa-eye"></i> </a>
                                            {% endif %}
                                        </td>
                                        <td style="text-align: center">
                                            {{ proyecto.tiempomes }} meses
                                            {% if proyecto.estado.valor == 18 or proyecto.estado.valor == 20 or proyecto.estado.valor == 21 %}
                                                <table class='table table-striped table-bordered'>
                                                    <tbody>
                                                        <tr>
                                                            <td><span class="label label-info tu" title="Fecha Inicio">FI:</span></td>
                                                            <td>{{ proyecto.fechainicio|date:"d-m-Y" }}</td>
                                                        </tr>
                                                        <tr>
                                                            <td><span class="label label-warning tu" title="Fecha Fin Estimada">FF:</span></td>
                                                            <td>{{ proyecto.fechafinplaneado|date:"d-m-Y" }}</td>
                                                        </tr>
                                                        {% if proyecto.fechafinreal %}
                                                            <tr>
                                                                <td><span class="label label-success tu" title="Fecha Fin Real">FR:</span></td>
                                                                <td>{{ proyecto.fechafinreal|date:"d-m-Y" }}</td>
                                                            </tr>
                                                        {% endif %}
                                                    </tbody>
                                                </table>
                                            {% endif %}
                                        </td>
                                        <td style="text-align: center">
                                            {% if proyecto.tipo %}
                                                <span class="label label-warning">{{ proyecto.get_tipo_display }}</span><br>
                                            {% endif %}
                                            {{ proyecto.get_tipocobertura_display }}
                                        </td>
                                        <td style="text-align: right">
                                            <span class="label label-success tu" title="Financiado UNEMI">$ {{ proyecto.montounemi|floatformat:2|intcomma }}</span>
                                            <br><span class="label label-inverse tu" title="Financiado Otros">$ {{ proyecto.montootrafuente|floatformat:2|intcomma }}</span>
                                            <br><span class="label label-info tu" title="Monto total">$ {{ proyecto.montototal|floatformat:2|intcomma }}</span>
                                        </td>
                                        <td style="text-align: right">
                                            {% if not proyecto.presupuesto_excede_montoproyecto %}
                                                $ {{ proyecto.presupuesto|floatformat:2|intcomma }}
                                            {% else %}
                                                <span class="label label-important">$ {{ proyecto.presupuesto|floatformat:2|intcomma }}</span><br>
                                                <small class="form-text text-muted" style="color: red">El monto del presupuesto no debe exceder a $ {{ proyecto.montototal|floatformat:2|intcomma }}</small>
                                            {% endif %}
                                        </td>
                                        <td style="text-align: center">
                                            <span class="{{ proyecto.estado.clase }} tu" title="{{ proyecto.estado.observacion }}">{{ proyecto.estado.descripcion }}</span>
                                            {% if proyecto.estado.valor == 4 %}
                                                <br><a href="javascript:;" id="{{ proyecto.id|encrypt }}" class="btn btn-info mostrarnovedad btn-mini" data-bs-toggle="tooltip" data-bs-placement="top" title="Mostrar Novedades"><i class="fa fa-align-justify"></i></a>
                                            {% endif %}
                                            {% if proyecto.estado.valor == 18 and proyecto.estadocronograma == 4 %}
                                                <span class="label label-warning tu" title="EXISTEN NOVEDADES CON EL CRONOGRAMA DE ACTIVIDADES">NOVEDADES<br>CRONOGRAMA</span>
                                            {% endif %}
                                            {% if proyecto.fase_aprobacion_superada %}
                                                Cumplimiento:
                                                {% with valoresavance=proyecto.valores_avance %}
                                                    <div class="progress">
                                                        <div class="progress-bar bg-success tu" title="{{ valoresavance.cumplimiento }}% cumplido" role="progressbar" style="width: {{ valoresavance.cumplimiento }}%" aria-valuenow="{{ valoresavance.cumplimiento }}" aria-valuemin="0" aria-valuemax="100">{% if valoresavance.cumplimiento >= 20 %}{{ valoresavance.cumplimiento }}%{% endif %}</div>
                                                        <div class="progress-bar bg-warning tu" {% if valoresavance.porcumplir == 100 %}title="0% cumplido"{% endif %} role="progressbar" style="width: {{ valoresavance.porcumplir }}%" aria-valuenow="{{ valoresavance.porcumplir }}" aria-valuemin="0" aria-valuemax="100">{% if valoresavance.porcumplir == 100 %}0%{% endif %}</div>
                                                    </div>
                                                {% endwith %}
                                            {% endif %}
                                        </td>
                                        <td style="text-align: center;">
                                            <div class="dropbottom" style="text-align: left">
                                            <button type="button" class="btn btn-default dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Acciones <i class="fa fa-angle-down"></i></button>
                                            <ul class="dropdown-menu pull-right" x-placement="right-start">
                                                <li class="dropdown-item"><a class="mostrarrecorrido" id="{{ proyecto.id|encrypt }}" href="javascript:;"><i class="fa fa-list-ol"></i> Mostrar Recorrido</a></li>
                                                <li class="dropdown-item"><a href="/pro_proyectoinvestigacion?action=informacionproyecto&id={{ proyecto.id|encrypt }}"><i class="fa fa-paste"></i> Mostrar Información</a></li>
                                                {% if proyecto.estado.valor == 2 or proyecto.estado.valor == 5 %}
                                                    <li class="dropdown-item"><a class="habilitar" id="{{ proyecto.id|encrypt }}" titulo="<b>{{ proyecto.titulo }}</b>" href="javascript:;"><i class="fa fa-pencil-square-o"></i> Habilitar Edición</a></li>
                                                {% endif %}
                                                {% if rolparticipante.id == 1 and not proyecto.fase_aprobacion_superada %}
                                                    {% if proyecto.puede_editar %}
                                                        <li class="dropdown-item"><a href="/pro_proyectoinvestigacion?action=editpropuestaproyecto&id={{ proyecto.id|encrypt }}"><i class="fa fa-edit"></i> Editar Datos Generales</a></li>
                                                        <li class="dropdown-item"><a href="/pro_proyectoinvestigacion?action=personalproyecto&id={{ proyecto.id|encrypt }}"><i class="fa fa-users"></i> Integrantes</a></li>
                                                        <li class="dropdown-item"><a href="/pro_proyectoinvestigacion?action=contenidoproyecto&id={{ proyecto.id|encrypt }}"><i class="fa fa-list"></i> Contenido</a></li>
                                                    {% endif %}
                                                    {% if proyecto.resumenpropuesta and proyecto.puede_editar %}
                                                        <li class="dropdown-item"><a href="/pro_proyectoinvestigacion?action=presupuesto&id={{ proyecto.id|encrypt }}"><i class="fa fa-money"></i> Presupuesto</a></li>
                                                        <li class="dropdown-item"><a href="/pro_proyectoinvestigacion?action=cronograma&id={{ proyecto.id|encrypt }}"><i class="fa fa-tasks"></i> Cronograma</a></li>
                                                        {% if proyecto.cronograma_asignado %}
                                                            {% if proyecto.convocatoria.apertura.year == 2022 %}
                                                                {% if proyecto.puede_subir_archivo_presupuesto %}
                                                                    <div class="dropdown-divider"></div>
                                                                    {% if proyecto.convocatoria.archivoformatopresupuesto %}
                                                                        <li class="dropdown-item"><a target="_blank" href="{{ proyecto.convocatoria.archivoformatopresupuesto.url }}"><i class="fa fa-download"></i> Formato Presupuesto Final</a></li>
                                                                    {% endif %}
                                                                    <li class="dropdown-item"><a href="javascript:;" class="subirpresupuesto" id="{{ proyecto.id|encrypt }}"><i class="fa fa-cloud-upload"></i> Subir Presupuesto Final</a></li>
                                                                {% endif %}
                                                            {% endif %}
                                                            {% if proyecto.puede_generar_documento %}
                                                                <div class="dropdown-divider"></div>
                                                                <li class="dropdown-item"><a class="generardocumento" id="{{ proyecto.id|encrypt }}" href="javascript:;"><i class="fa fa-cubes"></i> Generar Documento</a></li>
                                                            {% endif %}
                                                            {% if proyecto.puede_subir_documento and proyecto.documentogenerado %}
                                                                <li class="dropdown-item"><a href="javascript:;" class="subirdocumento" id="{{ proyecto.id|encrypt }}"><i class="fa fa-cloud-upload"></i> Subir Documento Firmado</a></li>
                                                                {% if proyecto.archivodocumentofirmado %}
                                                                    <li class="dropdown-item"><a href="/pro_proyectoinvestigacion?action=finalizaedicion&id={{ proyecto.id|encrypt }}"><i class="fa fa-check"></i> Finalizar Edición</a></li>
                                                                {% endif %}
                                                            {% endif %}
                                                            {% if proyecto.tiene_evaluaciones_cerradas %}
                                                                <div class="dropdown-divider"></div>
                                                                <li class="dropdown-item"><a class="mostrarevaluaciones" id="{{ proyecto.id|encrypt }}" href="javascript:;"><i class="fa fa-search-plus"></i> Mostrar Evaluaciones</a></li>
                                                            {% endif %}
                                                            {% if proyecto.estado.valor == 20 %}
                                                                {% if not proyecto.tiene_conflicto_fecha_cronograma %}
                                                                    <li class="dropdown-item"><a href="/pro_proyectoinvestigacion?action=informesproyecto&id={{ proyecto.id|encrypt }}"><i class="fa fa-file-text"></i> Informes</a></li>
                                                                {% endif %}
                                                            {% endif %}
                                                        {% endif %}
                                                    {% endif %}
                                                    {% if proyecto.estado.valor == 1 or proyecto.estado.valor == 2 %}
                                                        <div class="dropdown-divider"></div>
                                                        <li class="dropdown-item"><a class="eliminar" id="{{ proyecto.id|encrypt }}" titulo="<b>{{ proyecto.titulo }}</b>" href="javascript:;"><i class="fa fa-remove"></i> Eliminar</a></li>
                                                    {% endif %}
                                                    {% if proyecto.estado.valor == 13 and proyecto.convocatoria.apertura.year == 2023 %}
                                                        <div class="dropdown-divider"></div>
                                                        <li class="dropdown-item"><a href="/pro_proyectoinvestigacion?action=presupuesto&id={{ proyecto.id|encrypt }}"><i class="fa fa-money"></i> Presupuesto</a></li>
                                                    {% endif %}
                                                {% else %}
                                                    {% if rolparticipante.id == 1 and proyecto.estado.valor == 20 and proyecto.convocatoria.apertura.year == 2022 %}
                                                        <div class="dropdown-divider"></div>
                                                        <li class="dropdown-item"><a href="javascript:;" class="subirpresupuesto" id="{{ proyecto.id|encrypt }}"><i class="fa fa-cloud-upload"></i> Subir Presupuesto Actualizado</a></li>
                                                    {% endif %}
                                                    {% if proyecto.tiene_evaluaciones_cerradas and proyecto.convocatoria.apertura.year > 2020 %}
                                                        <li class="dropdown-item"><a class="mostrarevaluaciones" id="{{ proyecto.id|encrypt }}" href="javascript:;"><i class="fa fa-search-plus"></i> Mostrar Evaluaciones</a></li>
                                                    {% endif %}
                                                    {% if proyecto.fase_aprobacion_superada %}
                                                        <div class="dropdown-divider"></div>
                                                        <li class="dropdown-item"><a href="/pro_proyectoinvestigacion?action=informesproyecto&id={{ proyecto.id|encrypt }}"><i class="fa fa-file-text"></i> Informes</a></li>
                                                    {% endif %}
                                                {% endif %}
                                            </ul>
                                            </div>
                                        </td>
                                    </tr>
                                    {% if proyecto.cronograma_asignado and proyecto.estado.valor == 1 %}
                                        <tr>
                                            <td colspan="10">
                                                <div class="alert alert-info">
                                                    <strong>Consideraciones para generar el documento del proyecto:</strong>
                                                    <ul>
                                                        <li>1. El presupuesto debe estar completo</li>
                                                        <li>2. El cronograma de actividades debe cumplir con el 100% de la ponderación y la cantidad de meses acumulada de las mismas debe ser igual a la cantidad de meses de duración del proyecto</li>
                                                        <li>3. La cantidad mínima de integrantes debe ser la solicitada</li>
                                                    </ul>
                                                </div>
                                                {% with advertencias=proyecto.advertencias_generar_documento %}
                                                    {% if advertencias %}
                                                        <div class="alert alert-danger">
                                                            <strong>Advertencias encontradas:</strong>
                                                            <ul>
                                                                {% for advertencia in advertencias %}
                                                                    <li>{{ forloop.counter }}. {{ advertencia.mensaje|safe }}</li>
                                                                {% endfor %}
                                                            </ul>
                                                        </div>
                                                    {% endif %}
                                                {% endwith %}
                                            </td>
                                        </tr>
                                    {% endif %}
                                {% endwith %}
                            {% empty %}
                                <tr><td style="text-align: center" colspan="10">NO EXISTEN REGISTROS DE PROPUESTAS DE PROYECTOS</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer border-top-0">
                {% include 'paginacionb4.html' %}
            </div>
        </div>
        {# TABLA DE DATOS #}
    </div>

    <div class="modal fade static"  id="itemspanelrecorrido" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-list-ol"></i>&nbsp;<span class="paneltitlerecorrido">Mostrar Recorrido de la Convocatoria</span></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body panelbodyrecorrido">

                </div>
                <div class="modal-footer" id="footermodal">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static"  id="itemspanelevaluaciones" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-search-plus"></i>&nbsp;<span class="paneltitleevaluaciones">Mostrar Recorrido de la Convocatoria</span></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body panelbodyevaluaciones">

                </div>
                <div class="modal-footer" id="footermodal">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade static"  id="itemspanelsubirdocumento" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-cloud-upload"></i>&nbsp;<span class="paneltitlesubirdocumento">Mostrar Recorrido de la Convocatoria</span></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body panelbodysubirdocumento">

                </div>
                <div class="modal-footer" id="footermodal">
                    <button type="button" class="btn btn-success guardar"> Guardar</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static"  id="itemspanelnovedad" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-warning"></i>&nbsp;<span class="paneltitlenovedad">Mostrar Recorrido de la Convocatoria</span></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body panelbodynovedad">

                </div>
                <div class="modal-footer" id="footermodal">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static"  id="itemspanelsubirpresupuesto" style="display: none;">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4><i class="fa fa-cloud-upload"></i>&nbsp;<span class="paneltitlesubirpresupuesto">Mostrar Recorrido de la Convocatoria</span></h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body panelbodysubirpresupuesto">

                </div>
                <div class="modal-footer" id="footermodal">
                    <button type="button" class="btn btn-success guardar"> Guardar</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal"> Cerrar</button>
                </div>
            </div>
        </div>
    </div>

{% endblock %}